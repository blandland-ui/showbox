<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Item Detail — BlackSiteDB</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* minimal local styles for scaffold */
    body { background:#0f0f0f; color:#ddd; font-family:system-ui,Segoe UI,Roboto,Arial; margin:0; }
    header { padding:12px 16px; border-bottom:1px solid rgba(255,255,255,0.03); }
    .logo { font-weight:700; color:#fff; }
    main { max-width:1100px; margin:18px auto; padding:0 16px; }
    #hero { display:flex; gap:18px; align-items:flex-start; flex-wrap:wrap; }
    #poster img { width:320px; border-radius:8px; box-shadow:0 8px 24px rgba(0,0,0,0.6); }
    #meta h1 { margin:0 0 8px 0; font-size:1.5rem; color:#fff; }
    .muted { color:#aaa; font-size:0.95rem; }
    #watch-links a { display:inline-block; margin-right:8px; margin-top:10px; padding:8px 10px; background:#111; color:#ddd; border-radius:8px; text-decoration:none; border:1px solid rgba(255,255,255,0.03); }
    @media (max-width:820px){ #poster img{width:220px} }
  </style>
</head>
<body>
  <header><div class="logo">BlackSiteDB.org</div></header>

  <main id="detail-main" aria-live="polite">
    <section id="hero" role="region" aria-label="Item hero">
      <div id="poster" aria-hidden="false"></div>
      <div id="meta">
        <h1 id="title">Loading…</h1>
        <div id="submeta" class="muted">—</div>
        <p id="overview" style="margin-top:12px;color:#ddd;max-width:680px;">Loading description…</p>
        <div id="watch-links" aria-label="Watch links"></div>
      </div>
    </section>

    <section id="cast-related" style="display:flex;gap:20px;margin-top:18px;flex-wrap:wrap">
      <div id="cast" style="flex:1;min-width:260px">
        <h3 style="margin:0 0 8px 0;color:#fff">Cast</h3>
        <div id="cast-list" style="display:flex;gap:8px;flex-wrap:wrap"></div>
      </div>

      <aside id="related" style="width:300px;min-width:220px">
        <h3 style="margin:0 0 8px 0;color:#fff">Related</h3>
        <div id="related-list"></div>
      </aside>
    </section>

    <section id="comments" style="margin-top:18px;">
      <h3 style="margin:0 0 8px 0;color:#fff">Comments</h3>
      <div id="comment-list" style="color:#bbb">No comments (scaffold)</div>
    </section>
  </main>

  <script>
    // fetch ?id=... and render; falls back to sample data if API not available
    (async function(){
      const params = new URLSearchParams(location.search);
      const id = params.get('id') || '1';

      async function fetchItem(id){
        try {
          const res = await fetch(`/api/item?id=${encodeURIComponent(id)}`);
          if (!res.ok) throw new Error('no-api');
          return await res.json();
        } catch {
          // fallback sample item
          return {
            id,
            title: 'Sample Title ' + id,
            year: 2021,
            genre: 'Drama',
            poster: 'https://via.placeholder.com/640x960.png?text=Poster+'+id,
            overview: 'This is a placeholder overview. Replace with API data from /api/item?id=... .',
            cast: [{name:'Actor A'},{name:'Actor B'},{name:'Actor C'}],
            related: [{id:2,title:'Related One'},{id:3,title:'Related Two'}],
            watch: [{label:'Watch — Example',url:'#'}]
          };
        }
      }

      function render(item){
        document.getElementById('poster').innerHTML = `<img src="${item.poster}" alt="${escapeHtml(item.title)} poster">`;
        document.getElementById('title').textContent = item.title || '—';
        document.getElementById('submeta').textContent = `${item.year || ''} ${item.genre ? '• ' + item.genre : ''}`;
        document.getElementById('overview').textContent = item.overview || '';
        document.getElementById('watch-links').innerHTML = (item.watch || []).map(w=>`<a href="${w.url}">${escapeHtml(w.label)}</a>`).join('');
        document.getElementById('cast-list').innerHTML = (item.cast||[]).map(c=>`<div style="min-width:90px;padding:6px 8px;background:#151515;border-radius:8px">${escapeHtml(c.name)}</div>`).join('');
        document.getElementById('related-list').innerHTML = (item.related||[]).map(r=>`<div style="padding:6px 0"><a href="movie-detail.html?id=${r.id}" style="color:#ddd;text-decoration:none">${escapeHtml(r.title)}</a></div>`).join('');
      }

      function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

      const item = await fetchItem(id);
      render(item);
    })();
  </script>
</body>
</html>