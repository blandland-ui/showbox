<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Discover popular movies, latest releases, and top-rated films">
  <title>Movies - FossBOX</title>
  <link rel="stylesheet" href="../assets/css/styles.css">
  <script src="../assets/js/config.js"></script>
  <script src="../assets/js/mobile-redirect.js"></script>
</head>
<body>
  <!-- Header -->
  <header class="site-header" style="height: 200px; background: linear-gradient(135deg, var(--bg-secondary), var(--bg-primary)); position: relative; display: flex; align-items: center; justify-content: center;">
    <div class="logo" style="display: flex; align-items: center; position: absolute; left: 80px; top: 50%; transform: translateY(-50%); z-index: 10;">
      <img src="../assets/site-logo.png" alt="Showbox Logo" style="height: 100px; margin-right: 20px; opacity: 0.5; box-shadow: 0 8px 16px rgba(0,0,0,0.6), 0 4px 8px rgba(0,0,0,0.4);">
      <span style="font-size: 3rem; font-weight: 800; color: #A3FC13; text-shadow: 0 4px 8px rgba(0,0,0,0.8);">Show<strong style="color: #fe531e;">box</strong></span>
    </div>
    
    <!-- Header Search -->
    <div class="header-search">
      <form class="search-form" id="headerSearchForm">
        <input type="text" id="headerSearchInput" placeholder="Search movies & TV shows..." autocomplete="off">
        <button type="submit" class="search-btn">üîç</button>
      </form>
      <div class="search-results" id="headerSearchResults" style="display: none;"></div>
    </div>

    <!-- Navigation -->
    <nav class="site-nav" role="navigation" aria-label="Main navigation">
      <a href="../index.html">HOME</a>
      <a href="movies.html" style="color: var(--text-primary);">Movies</a>
      <a href="tv.html">TV Shows</a>
      <a href="cartoons.html">Cartoons/Anime</a>
      <a href="../randomizer.html" style="color: #ff6b6b;">Find Something To Watch...</a>
      <a href="about.html">About</a>
    </nav>
  </header>

  <!-- Main content -->
  <main class="main-wrap" role="main">
    <!-- Breadcrumb -->
    <nav class="breadcrumb" aria-label="Page location">
      <a href="../index.html">Home</a> <span>‚Ä∫</span>
      <span style="color: var(--text-primary);">Movies</span>
    </nav>

    <h1 style="font-size: 2.5rem; margin-bottom: var(--spacing-lg); color: var(--accent-primary); text-align: center;">Movies</h1>

    <!-- Filter controls -->
    <div style="background: var(--bg-secondary); padding: var(--spacing-lg); border-radius: var(--radius-large); margin-bottom: var(--spacing-xl); border: 1px solid var(--border-color);">
      <div style="display: flex; gap: var(--spacing-lg); flex-wrap: wrap; align-items: center; justify-content: center;">
        <button class="filter-btn active" data-category="popular">Popular</button>
        <button class="filter-btn" data-category="now_playing">Now Playing</button>
        <button class="filter-btn" data-category="upcoming">Upcoming</button>
        <button class="filter-btn" data-category="top_rated">Top Rated</button>
      </div>
    </div>

    <!-- Filter Bar -->
    <div class="filter-bar">
      <div class="filter-bar-content">
        <div class="filter-group">
          <label class="filter-label" for="genre-filter">Genre</label>
          <select id="genre-filter" class="filter-dropdown">
            <option value="">All Genres</option>
            <option value="action">Action</option>
            <option value="adventure">Adventure</option>
            <option value="comedy">Comedy</option>
            <option value="drama">Drama</option>
            <option value="horror">Horror</option>
            <option value="thriller">Thriller</option>
            <option value="sci-fi">Sci-Fi</option>
            <option value="fantasy">Fantasy</option>
            <option value="romance">Romance</option>
            <option value="crime">Crime</option>
            <option value="mystery">Mystery</option>
            <option value="animation">Animation</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label class="filter-label" for="year-filter">Year</label>
          <select id="year-filter" class="filter-dropdown">
            <option value="">All Years</option>
            <option value="2024">2024</option>
            <option value="2023">2023</option>
            <option value="2022">2022</option>
            <option value="2021">2021</option>
            <option value="2020">2020</option>
            <option value="2019">2019</option>
            <option value="2018">2018</option>
            <option value="2017">2017</option>
            <option value="2016">2016</option>
            <option value="2015">2015</option>
            <option value="older">Older</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label class="filter-label" for="rating-filter">Rating</label>
          <select id="rating-filter" class="filter-dropdown">
            <option value="">All Ratings</option>
            <option value="9+">9.0+ Excellent</option>
            <option value="8+">8.0+ Very Good</option>
            <option value="7+">7.0+ Good</option>
            <option value="6+">6.0+ Average</option>
            <option value="5+">5.0+ Below Average</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Movies grid -->
    <div class="movie-list" id="movies-grid" aria-live="polite">
    </div>

    <!-- Pagination -->
    <div id="pagination-container" style="display: none; text-align: center; margin-top: var(--spacing-xl); padding: var(--spacing-lg) 0;">
      <div class="pagination" style="display: inline-flex; align-items: center; gap: 8px; background: var(--bg-secondary); padding: 12px 20px; border-radius: var(--radius-large); border: 1px solid var(--border-color);">
        <button id="prev-btn" class="pagination-btn" style="padding: 8px 12px; background: var(--bg-primary); color: var(--text-secondary); border: 1px solid var(--border-color); border-radius: var(--radius-small); cursor: pointer; font-size: 0.9rem;" disabled>
          ‚Äπ Prev
        </button>
        <div id="page-numbers" style="display: flex; align-items: center; gap: 4px; margin: 0 12px;">
          <!-- Page numbers will be inserted here -->
        </div>
        <button id="next-btn" class="pagination-btn" style="padding: 8px 12px; background: var(--bg-primary); color: var(--text-secondary); border: 1px solid var(--border-color); border-radius: var(--radius-small); cursor: pointer; font-size: 0.9rem;">
          Next ‚Ä∫
        </button>
      </div>
      <div style="margin-top: 8px; color: var(--text-muted); font-size: 0.85rem;">
        Page <span id="current-page-display">1</span> of <span id="total-pages-display">1</span>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="site-footer" role="contentinfo">
    <p>&copy; 2024 www.fossbox.cc. All rights reserved.</p>
    <p>Powered by <a href="https://www.themoviedb.org/" target="_blank" rel="noopener">The Movie Database (TMDb)</a></p>
  </footer>

  <style>
    .filter-btn {
      padding: var(--spacing-sm) var(--spacing-lg);
      background: var(--bg-primary);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-medium);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .filter-btn:hover {
      background: var(--bg-accent);
      color: var(--text-primary);
    }

    .filter-btn.active {
      background: var(--accent-primary);
      color: var(--text-primary);
      border-color: var(--border-light);
    }
  </style>

  <script>
    // Movie page specific functionality
    class MoviePage {
      constructor() {
        this.currentCategory = 'popular';
        this.currentPage = 1;
        this.loading = false;
        this.init();
      }

      init() {
        console.log('üé¨ MoviePage initialized');
        console.log('üì° API Key present:', !!window.TMDB_API_KEY);
        this.totalPages = 1;
        this.loadMovies();
        this.setupFilterButtons();
        this.setupPagination();
      }

      setupFilterButtons() {
        const filterBtns = document.querySelectorAll('.filter-btn');
        filterBtns.forEach(btn => {
          btn.addEventListener('click', (e) => {
            // Update active state
            filterBtns.forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            
            // Load new category
            this.currentCategory = e.target.dataset.category;
            this.currentPage = 1;
            this.loadMovies(true);
          });
        });
      }

      setupPagination() {
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        
        prevBtn.addEventListener('click', () => {
          if (this.currentPage > 1) {
            this.currentPage--;
            this.loadMovies(true);
          }
        });

        nextBtn.addEventListener('click', () => {
          if (this.currentPage < this.totalPages && this.currentPage < 20) {
            this.currentPage++;
            this.loadMovies(true);
          }
        });
      }

      async loadMovies(clearGrid = false) {
        if (this.loading) return;
        this.loading = true;

        const grid = document.getElementById('movies-grid');
        const paginationContainer = document.getElementById('pagination-container');

        console.log('üîÑ loadMovies called - clearGrid:', clearGrid, 'category:', this.currentCategory, 'page:', this.currentPage);

        if (clearGrid) {
          grid.innerHTML = ''; // Clear grid completely - CSS will show loading text
          paginationContainer.style.display = 'none';
        }

        try {
          const API_KEY = window.TMDB_API_KEY;
          if (!API_KEY) {
            throw new Error('API key not configured');
          }

          console.log('üì° Fetching movies from TMDB...');

          // Fetch 2 pages to get 35+ items for 7x5 grid
          const page1Response = await fetch(
            `https://api.themoviedb.org/3/movie/${this.currentCategory}?api_key=${API_KEY}&language=en-US&page=${this.currentPage}`
          );
          
          if (!page1Response.ok) {
            throw new Error(`HTTP error! status: ${page1Response.status}`);
          }

          const page1Data = await page1Response.json();
          let allResults = page1Data.results;
          
          console.log('üì¶ Page 1 results:', allResults.length);
          
          // If we need more items to reach 35, fetch next page
          if (allResults.length < 35 && page1Data.total_pages > this.currentPage) {
            const page2Response = await fetch(
              `https://api.themoviedb.org/3/movie/${this.currentCategory}?api_key=${API_KEY}&language=en-US&page=${this.currentPage + 1}`
            );
            if (page2Response.ok) {
              const page2Data = await page2Response.json();
              allResults = [...allResults, ...page2Data.results];
              console.log('üì¶ Page 2 results added. Total:', allResults.length);
            }
          }
          
          // Take exactly 35 items for 7x5 grid
          const displayResults = allResults.slice(0, 35);
          
          // DEBUG: Log what we're about to display
          console.log('üìä Movies to display:', displayResults.length);
          console.log('üì¶ Full results:', allResults.length);
          
          this.totalPages = Math.min(page1Data.total_pages, 20); // Limit to 20 pages for performance
          this.displayMovies(displayResults, true); // Always clear grid for pagination
          this.updatePagination();
          
          // Show pagination if there are multiple pages
          if (this.totalPages > 1) {
            paginationContainer.style.display = 'block';
          }

        } catch (error) {
          console.error('‚ùå Failed to load movies:', error);
          if (clearGrid) {
            grid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; color: var(--text-muted); padding: var(--spacing-xl);">Failed to load movies. Please try again later.</div>';
          }
        }

        this.loading = false;
        console.log('‚úÖ loadMovies complete');
      }

      updatePagination() {
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const pageNumbers = document.getElementById('page-numbers');
        const currentPageDisplay = document.getElementById('current-page-display');
        const totalPagesDisplay = document.getElementById('total-pages-display');

        // Update page display
        currentPageDisplay.textContent = this.currentPage;
        totalPagesDisplay.textContent = this.totalPages;

        // Update prev/next buttons
        prevBtn.disabled = this.currentPage <= 1;
        nextBtn.disabled = this.currentPage >= this.totalPages;

        // Update button styles based on disabled state
        prevBtn.style.opacity = prevBtn.disabled ? '0.5' : '1';
        prevBtn.style.cursor = prevBtn.disabled ? 'not-allowed' : 'pointer';
        nextBtn.style.opacity = nextBtn.disabled ? '0.5' : '1';
        nextBtn.style.cursor = nextBtn.disabled ? 'not-allowed' : 'pointer';

        // Generate page numbers
        this.generatePageNumbers();
      }

      generatePageNumbers() {
        const pageNumbers = document.getElementById('page-numbers');
        pageNumbers.innerHTML = '';

        const maxVisiblePages = 7;
        let startPage = Math.max(1, this.currentPage - Math.floor(maxVisiblePages / 2));
        let endPage = Math.min(this.totalPages, startPage + maxVisiblePages - 1);
        
        // Adjust start page if we're near the end
        if (endPage - startPage + 1 < maxVisiblePages) {
          startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }

        // Add first page and ellipsis if needed
        if (startPage > 1) {
          this.addPageButton(1);
          if (startPage > 2) {
            const ellipsis = document.createElement('span');
            ellipsis.textContent = '...';
            ellipsis.style.cssText = 'color: var(--text-muted); padding: 0 4px;';
            pageNumbers.appendChild(ellipsis);
          }
        }

        // Add visible page numbers
        for (let i = startPage; i <= endPage; i++) {
          this.addPageButton(i);
        }

        // Add ellipsis and last page if needed
        if (endPage < this.totalPages) {
          if (endPage < this.totalPages - 1) {
            const ellipsis = document.createElement('span');
            ellipsis.textContent = '...';
            ellipsis.style.cssText = 'color: var(--text-muted); padding: 0 4px;';
            pageNumbers.appendChild(ellipsis);
          }
          this.addPageButton(this.totalPages);
        }
      }

      addPageButton(pageNum) {
        const pageNumbers = document.getElementById('page-numbers');
        const button = document.createElement('button');
        button.textContent = pageNum;
        button.style.cssText = `
          padding: 6px 10px;
          border: 1px solid var(--border-color);
          border-radius: var(--radius-small);
          cursor: pointer;
          font-size: 0.85rem;
          min-width: 32px;
          transition: all 0.2s;
        `;

        if (pageNum === this.currentPage) {
          button.style.cssText += `
            background: var(--accent-primary);
            color: var(--text-primary);
            border-color: var(--accent-primary);
          `;
        } else {
          button.style.cssText += `
            background: var(--bg-primary);
            color: var(--text-secondary);
          `;
          button.addEventListener('mouseover', () => {
            button.style.background = 'var(--bg-accent)';
            button.style.color = 'var(--text-primary)';
          });
          button.addEventListener('mouseout', () => {
            button.style.background = 'var(--bg-primary)';
            button.style.color = 'var(--text-secondary)';
          });
        }

        button.addEventListener('click', () => {
          if (pageNum !== this.currentPage) {
            this.currentPage = pageNum;
            this.loadMovies(true);
          }
        });

        pageNumbers.appendChild(button);
      }

      displayMovies(movies, clearGrid = false) {
        const grid = document.getElementById('movies-grid');
        const ad = document.getElementById('movies-ad');
        
        // DEBUG: Log what's being displayed
        console.log('üé¨ displayMovies called with', movies.length, 'movies');
        
        if (clearGrid) {
          grid.innerHTML = '';
          // Re-add the ad space
          if (ad) {
            grid.appendChild(ad);
          }
        }

        if (!movies || movies.length === 0) {
          if (clearGrid) {
            grid.innerHTML = '<p class="text-center" style="color: var(--text-muted); grid-column: 1 / -1; padding: 40px;">No movies found.</p>';
          }
          return;
        }

        // Hide ad when content loads
        if (ad) {
          ad.style.display = 'none';
        }

        movies.forEach(movie => {
          const movieElement = this.createMovieElement(movie);
          grid.appendChild(movieElement);
        });
        
        // DEBUG: Verify DOM after rendering
        console.log('‚úÖ Grid now has', grid.querySelectorAll('.movie-item').length, 'movie items');
      }

      createMovieElement(movie) {
        const movieDiv = document.createElement('div');
        movieDiv.className = 'movie-item';
        movieDiv.style.cursor = 'pointer';
        
        const posterUrl = movie.poster_path
          ? `https://image.tmdb.org/t/p/w500${movie.poster_path}`
          : 'https://via.placeholder.com/200x300/333/fff?text=No+Image';

        const releaseYear = movie.release_date ? new Date(movie.release_date).getFullYear() : 'Unknown';
        const rating = movie.vote_average ? movie.vote_average.toFixed(1) : 'N/A';

        movieDiv.innerHTML = `
          <img src="${posterUrl}" alt="${movie.title}" loading="lazy">
          <div class="movie-info" style="padding: 8px; display: flex; flex-direction: column; gap: 4px; min-height: 60px;">
            <h4 style="color: #A3FC13 !important; display: block !important; margin: 0 0 4px; font-size: 0.85rem; line-height: 1.3; visibility: visible !important; opacity: 1 !important;">${movie.title} (${releaseYear})</h4>
            <p class="movie-rating" style="color: #A3FC13 !important; font-size: 0.8rem !important; margin: 0 !important; display: block !important; visibility: visible !important; opacity: 1 !important;">‚≠ê ${rating}</p>
          </div>
        `;

        // Add click handler to go to player
        movieDiv.addEventListener('click', () => {
          const playerUrl = `../player.html?id=${movie.id}&type=movie&title=${encodeURIComponent(movie.title)}`;
          window.location.href = playerUrl;
        });

        return movieDiv;
      }
    }

    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      new MoviePage();
    });
  </script>

  <!-- Additional Scripts for Search -->
  <script src="../assets/js/app.js"></script>
  

</body>
</html>